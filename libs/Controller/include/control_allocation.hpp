#ifndef _CONTROL_ALLOCATION_H
#define _CONTROL_ALLOCATION_H
#include <iostream>

#define MAX_ROWS 201

// Value in Kgf of 12V on the lookup table
const float Array_Force_12V_Kgf [MAX_ROWS] = {-2.91659656, -2.9, -2.89, -2.83, -2.79, -2.76, -2.72, -2.67, -2.6, 
                                        -2.59,-2.56, -2.49, -2.44, -2.43, -2.39, -2.34, -2.3, -2.25, -2.23, 
                                        -2.18,-2.14, -2.1, -2.07, -2.01, -1.98, -1.95, -1.88, -1.85, -1.81, 
                                        -1.78, -1.73, -1.66, -1.65, -1.61, -1.56, -1.53, -1.49, -1.47, -1.44, 
                                        -1.4, -1.37, -1.33, -1.29, -1.28, -1.22, -1.19, -1.15, -1.12, -1.08, -1.04, 
                                        -1.02, -0.99, -0.96, -0.93, -0.9, -0.87, -0.83, -0.79, -0.77, -0.74, 
                                        -0.72, -0.69, -0.66, -0.64, -0.6, -0.57, -0.54, -0.52, -0.49, -0.47, 
                                        -0.44, -0.42, -0.39, -0.37, -0.34, -0.32, -0.29, -0.27, -0.24, -0.23, 
                                        -0.2, -0.18, -0.16, -0.15, -0.12, -0.11, -0.09, -0.07, -0.06, -0.05, 
                                        -0.04, -0.01, -0.01, -0.01, -0.01, -0.01, -0.001, -0.001, -0.001, -0.001, 0, 0.001, 0.001, 0.001, 
                                        0.001, 0.01, 0.01, 0.01, 0.01, 0.01, 0.04, 0.05, 0.07, 0.1, 0.11, 0.13, 
                                        0.15, 0.18, 0.2, 0.22, 0.25, 0.28, 0.31, 0.33, 0.37, 0.39, 0.43, 
                                        0.46, 0.49, 0.52, 0.55, 0.59, 0.63, 0.65, 0.68, 0.71, 0.76, 0.79, 
                                        0.83, 0.86, 0.89, 0.93, 0.97, 1, 1.04, 1.08, 1.14, 1.16, 1.2, 1.23, 
                                        1.28, 1.31, 1.35, 1.4, 1.43, 1.48, 1.53, 1.56, 1.63, 1.67, 1.71, 
                                        1.77, 1.82, 1.85, 1.91, 1.92, 1.96, 2.03, 2.09, 2.13, 2.18, 2.24, 
                                        2.27, 2.33, 2.4, 2.46, 2.51, 2.56, 2.62, 2.65, 2.71, 2.78, 2.84, 
                                        2.87, 2.93, 3.01, 3.04, 3.08, 3.16, 3.23, 3.26, 3.32, 3.38, 3.4, 
                                        3.45, 3.5, 3.57, 3.64, 3.69, 3.71, 3.71};

// Value in PWM on the lookup table
const float Array_PWM_Relative_12V_Kgf [MAX_ROWS] = {1100, 1104, 1108, 1112, 1116, 1120, 1124, 1128, 1132, 1136, 
                                                1140, 1144, 1148, 1152, 1156, 1160, 1164, 1168, 1172, 1176, 
                                                1180, 1184, 1188, 1192, 1196, 1200, 1204, 1208, 1212, 1216, 
                                                1220, 1224, 1228, 1232, 1236, 1240, 1244, 1248, 1252, 1256, 
                                                1260, 1264, 1268, 1272, 1276, 1280, 1284, 1288, 1292, 1296, 
                                                1300, 1304, 1308, 1312, 1316, 1320, 1324, 1328, 1332, 1336, 
                                                1340, 1344, 1348, 1352, 1356, 1360, 1364, 1368, 1372, 1376, 
                                                1380, 1384, 1388, 1392, 1396, 1400, 1404, 1408, 1412, 1416, 
                                                1420, 1424, 1428, 1432, 1436, 1440, 1444, 1448, 1452, 1456, 
                                                1460, 1464, 1468, 1472, 1476, 1480, 1484, 1488, 1492, 1496, 
                                                1500, 1504, 1508, 1512, 1516, 1520, 1524, 1528, 1532, 1536, 
                                                1540, 1544, 1548, 1552, 1556, 1560, 1564, 1568, 1572, 1576, 
                                                1580, 1584, 1588, 1592, 1596, 1600, 1604, 1608, 1612, 1616, 
                                                1620, 1624, 1628, 1632, 1636, 1640, 1644, 1648, 1652, 1656, 
                                                1660, 1664, 1668, 1672, 1676, 1680, 1684, 1688, 1692, 1696, 
                                                1700, 1704, 1708, 1712, 1716, 1720, 1724, 1728, 1732, 1736, 
                                                1740, 1744, 1748, 1752, 1756, 1760, 1764, 1768, 1772, 1776, 
                                                1780, 1784, 1788, 1792, 1796, 1800, 1804, 1808, 1812, 1816, 
                                                1820, 1824, 1828, 1832, 1836, 1840, 1844, 1848, 1852, 1856, 
                                                1860, 1864, 1868, 1872, 1876, 1880, 1884, 1888, 1892, 1896,1900};


// TCM (Thrust Configuration Matrix) parameters of interest
// Indices represent the row and column indexes of the TCM
#define a53 0.270321738048842
#define a54 1.845433061072183
#define a55 -1.123595505617978
#define a63 0.275856793399395
#define a64 -1.844603839296819
#define a65 -1.123595505617978 
#define a73 0.224143206600606
#define a74 1.844603839296820
#define a75 1.123595505617978
#define a83 0.229678261951159
#define a84 -1.845433061072184
#define a85 1.123595505617978

struct OutputValues {
    double T5, T6, T7, T8; // Vertical thrusters (that are the ones that affect z roll and pitch)
};

OutputValues compute_thrust(double Fz, double Fr, double Fp); // Convert Force along z and moments around roll and pitch into thrust forces
uint16_t lookup_table(float Force_12V_Kgf);

#endif